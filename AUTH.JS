// auth.js - Funciones de autenticaci√≥n reutilizables
export function verificarSesion() {
    const usuario = JSON.parse(localStorage.getItem("usuarioLogueado"));
    
    if (!usuario) {
        console.log("üîê No hay usuario logueado, redirigiendo a login...");
        // Usar replace para evitar que el usuario pueda volver atr√°s
        window.location.replace("login.html");
        return null;
    }
    
    // Verificar que el usuario est√© activo
    if (usuario.ESTADO !== "ACTIVO") {
        console.log("‚ö†Ô∏è Usuario inactivo");
        localStorage.removeItem("usuarioLogueado");
        window.location.replace("login.html");
        return null;
    }
    
    console.log("‚úÖ Usuario autenticado:", usuario.USUARIO);
    return usuario;
}

export function cerrarSesion() {
    if (confirm("¬øEst√°s seguro de que deseas cerrar sesi√≥n?")) {
        localStorage.removeItem("usuarioLogueado");
        window.location.replace("login.html");
    }
}

export function obtenerUsuarioActual() {
    return JSON.parse(localStorage.getItem("usuarioLogueado"));
}

export function verificarRol(rolesPermitidos) {
    const usuario = obtenerUsuarioActual();
    
    if (!usuario) {
        window.location.replace("login.html");
        return false;
    }
    
    if (!rolesPermitidos.includes(usuario.ROL)) {
        alert("No tienes permisos para acceder a esta p√°gina");
        window.location.replace("index.html"); // O a una p√°gina de error
        return false;
    }
    
    return true;
}
